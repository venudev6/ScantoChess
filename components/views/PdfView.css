/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
*/

/* container & toolbar */
.pdf-viewer-container { display:flex; flex-direction:column; height:100%; width:100%; position:relative; background:#f3f4f6; overflow:hidden; }
.pdf-toolbar { position:sticky; top:0; z-index:60; display:flex; align-items:center; justify-content:space-between; padding:0.5rem 1rem; background:#fff; border-bottom:1px solid var(--border-color); box-shadow:0 2px 4px rgba(0,0,0,0.04); }
.pdf-toolbar-left { display:flex; align-items:center; gap:0.75rem; }
.pdf-toolbar-right { display:flex; align-items:center; gap:0.75rem; }
.pdf-toolbar-center { justify-content:center; display:flex; align-items:center; gap:0.75rem;}

/* Modern Button Groups */
.pdf-toolbar-group {
    display: flex;
    align-items: stretch; /* Make items fill height */
    background-color: #f3f4f6;
    border-radius: 0.5rem;
    border: 1px solid var(--border-color);
    box-shadow: 0 1px 2px rgba(0,0,0,0.05);
    overflow: hidden; /* Hide internal button radii */
}

/* Allow the dropdown to be visible when its group is active */
.pdf-toolbar-group.dropdown-active {
    overflow: visible;
    position: relative; /* Anchor for the dropdown */
}

.pdf-toolbar-group > .btn-icon,
.pdf-toolbar-group > .page-input-container,
.pdf-toolbar-group > .options-menu-container {
    background: transparent;
    border: none;
    box-shadow: none;
    border-radius: 0;
    height: 40px; /* Consistent height for all items */
}

.pdf-toolbar-group > .btn-icon:hover:not(:disabled) {
    background-color: #e5e7eb;
}

/* Add separators between items inside a group */
.pdf-toolbar-group > *:not(:last-child) {
    border-right: 1px solid var(--border-color);
}

.pdf-toolbar-group .page-input-container {
    border: none;
}

/* Page Navigation Specifics */
.page-input-container { display:flex; align-items:center; gap:0.25rem; padding: 0 0.5rem; }
.page-input { width:4ch; height:100%; text-align:center; border:none; background:transparent; font-weight:500; font-size:1rem; color:var(--text-color); }
.page-input:focus { outline:none; }
.page-total { color:var(--text-muted-color); font-size:0.95rem; }

/* Options Dropdown */
.options-menu-container {
    position: relative;
    display: flex; /* Ensures button inside behaves like other flex items */
}
.options-dropdown {
    position: absolute;
    top: calc(100% + 8px);
    left: 50%;
    transform: translateX(-50%);
    background-color: #fff;
    border-radius: 0.5rem;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    border: 1px solid var(--border-color);
    width: 180px;
    z-index: 70;
    padding: 0.5rem;
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
    animation: slide-down-fade 0.2s ease-out; /* from UserMenu.css */
}
.options-dropdown button {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    width: 100%;
    padding: 0.6rem 0.75rem;
    border: none;
    background: transparent;
    text-align: left;
    border-radius: 0.375rem;
    cursor: pointer;
    font-size: 0.9rem;
    font-weight: 500;
    color: var(--text-color);
}
.options-dropdown button:hover {
    background-color: #f3f4f6;
}
.options-dropdown button svg {
    width: 20px;
    height: 20px;
    color: var(--text-muted-color);
}


/* body split */
.pdf-body { display:flex; flex:1 1 auto; height:calc(100% - 62px); overflow:hidden; }

/* filmstrip */
.pdf-filmstrip { background:#e5e7eb; color:var(--text-color); border-right:1px solid var(--border-color); overflow-y:auto; padding:12px 8px; box-sizing:border-box; display:flex; flex-direction:column; position:relative; }
.pdf-filmstrip-scroller { display:flex; flex-direction:column; gap:10px; }

/* thumbnails */
.pdf-thumb-item { position:relative; cursor:pointer; border-radius:4px; padding:0; box-sizing:border-box; min-height:110px; display:flex; align-items:center; justify-content:center; overflow:hidden; background:transparent; border:1px solid var(--border-color); }
.pdf-thumb-item:hover { transform:translateY(-2px); box-shadow:0 6px 18px rgba(0,0,0,0.05); }
.pdf-thumb-item.active { border:2px solid var(--primary-color); box-shadow:0 8px 24px rgba(0,0,0,0.08); }
.pdf-thumb-img { display:block; width:100%; height:100%; object-fit:contain; }
.pdf-thumb-placeholder { height:84px; display:flex; align-items:center; justify-content:center; color:var(--text-muted-color); font-size:12px; }
.pdf-thumb-page-number { position:absolute; right:6px; bottom:6px; background:rgba(255,255,255,0.85); color:var(--text-color); font-size:11px; font-weight:600; padding:2px 6px; border-radius:4px; pointer-events:none; border:1px solid rgba(0,0,0,0.04); }

/* main viewer */
.pdf-main-view { flex:1 1 auto; overflow:auto; position:relative; -webkit-overflow-scrolling:touch; background:transparent; padding:24px; }
.pdf-main-view.cropping-active { overflow: hidden; }

.pdf-main-view-scroller { display:flex; flex-direction:column; align-items:center; gap:1.5rem; box-sizing:border-box; }

.pdf-page-wrapper {
  position: relative;
  display: inline-block; /* Force shrink-wrapping around page content */
  line-height: 0;
  cursor: crosshair; /* Indicate that this area is interactive for cropping */
}

/* page */
.pdf-page-container { background:#fff; border:1px solid #d1d5db; box-shadow:0 8px 28px rgba(0,0,0,0.12); line-height:0; position:relative; width:fit-content; }
.pdf-page-placeholder {
    background-color: #fff;
    border: 1px solid #d1d5db;
    box-shadow: 0 8px 28px rgba(0,0,0,0.12);
    display: flex;
    align-items: center;
    justify-content: center;
}

/* puzzle overlay */
.puzzle-overlay {
  position: absolute;
  z-index: 10;
  cursor: pointer;
  border: none;
  background-color: transparent;
  transition: background-color 0.2s ease;
}

/* Horizontal line in the middle */
.puzzle-overlay::after {
  content: '';
  position: absolute;
  top: 50%;
  left: 5%; /* Don't touch the edges */
  right: 5%;
  height: 2px;
  background-color: rgba(211, 45, 39, 0.7); /* Logo red #D32D27 with transparency */
  transform: translateY(-50%);
  transition: background-color 0.2s ease;
}

/* Base style for corner markers */
.corner-marker {
  position: absolute;
  width: 15px; /* Size of the L-shape arms */
  height: 15px;
  border-color: rgba(211, 45, 39, 0.7); /* Logo red with transparency */
  border-style: solid;
  transition: border-color 0.2s ease;
}

/* Individual corner positioning and borders */
.corner-marker.top-left {
  top: 0;
  left: 0;
  border-width: 3px 0 0 3px;
}
.corner-marker.top-right {
  top: 0;
  right: 0;
  border-width: 3px 3px 0 0;
}
.corner-marker.bottom-left {
  bottom: 0;
  left: 0;
  border-width: 0 0 3px 3px;
}
.corner-marker.bottom-right {
  bottom: 0;
  right: 0;
  border-width: 0 3px 3px 0;
}

/* Hover effect */
.puzzle-overlay:hover {
  background-color: rgba(211, 45, 39, 0.1); /* Light red tint on hover */
}
.puzzle-overlay:hover .corner-marker {
    border-color: #D32D27; /* Solid red corners on hover */
}
.puzzle-overlay:hover::after {
    background-color: #D32D27; /* Solid red line on hover */
}


/* crop layer: occupies the page wrapper exactly */
.pdf-crop-layer {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  z-index: 40;
  pointer-events: none; /* Let clicks pass through unless a child element catches them */
}

/* New Cropping Tool Styles */
.crop-box {
    position: absolute;
    background: transparent;
    border: 2px solid var(--primary-color);
    box-shadow: 0 0 10px rgba(0,0,0,0.3);
    pointer-events: auto; /* This element and its children can be interacted with */
    cursor: move;
}

.resize-handle {
    position: absolute;
    width: 12px;
    height: 12px;
    background: rgba(255, 255, 255, 0.9);
    border: 1px solid var(--primary-color);
    border-radius: 50%;
}
.resize-handle-nw { top: -7px; left: -7px; cursor: nwse-resize; }
.resize-handle-ne { top: -7px; right: -7px; cursor: nesw-resize; }
.resize-handle-sw { bottom: -7px; left: -7px; cursor: nesw-resize; }
.resize-handle-se { bottom: -7px; right: -7px; cursor: nwse-resize; }
.resize-handle-n { top: -7px; left: 50%; transform: translateX(-50%); cursor: ns-resize; }
.resize-handle-s { bottom: -7px; left: 50%; transform: translateX(-50%); cursor: ns-resize; }
.resize-handle-w { top: 50%; left: -7px; transform: translateY(-50%); cursor: ew-resize; }
.resize-handle-e { top: 50%; right: -7px; transform: translateY(-50%); cursor: ew-resize; }

.crop-actions {
    position: absolute;
    bottom: -52px; /* Position below the crop box */
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 0.5rem;
    pointer-events: auto;
}

/* loading overlay */
.pdf-loading-overlay { position:absolute; inset:0; background:rgba(255,255,255,0.92); z-index:120; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:1rem; }

/* In-page scan overlay */
.pdf-page-scan-overlay {
  position: absolute;
  inset: 0;
  background: rgba(255, 255, 255, 0.85); /* Translucent white */
  backdrop-filter: blur(2px);
  z-index: 50; /* Above the page canvas, below the crop box UI */
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 1rem;
  padding: 1rem;
  text-align: center;
  border-radius: 4px; /* Match page container radius if any */
  color: var(--text-color);
}

.pdf-page-scan-overlay .spinner {
  width: 40px;
  height: 40px;
  border-width: 4px;
}

.pdf-page-scan-overlay progress {
  width: 80%;
  max-width: 250px;
}

/* helpers */
.thumb-loading { color:var(--text-muted-color); padding:8px; font-size:0.95rem; }

/* New styles for bare icon button */
.btn-icon-bare {
    background: transparent;
    border: none;
    box-shadow: none;
    height: 40px;
    width: 40px;
}
.btn-icon-bare:hover:not(:disabled) {
    background-color: #e5e7eb;
    border-radius: 50%; /* circular hover effect */
}
.btn-icon-bare svg {
    color: var(--text-muted-color);
    width: 24px;
    height: 24px;
}
.btn-icon-bare:hover:not(:disabled) svg {
    color: var(--text-color);
}

/* Styles for the Deep Scan button with text */
.pdf-toolbar-right .deep-scan-btn {
    height: 40px;
    padding: 0 0.75rem; /* 12px */
    font-size: 0.9rem;
}
.pdf-toolbar-right .deep-scan-btn.completed-scan {
    border-color: #dcfce7; /* green-100 */
    background-color: #f0fdf4; /* green-50 */
    color: #15803d; /* green-700 */
}
.pdf-toolbar-right .deep-scan-btn.completed-scan svg {
    color: #16a34a; /* green-600 */
}
.pdf-toolbar-right .deep-scan-btn.completed-scan:hover:not(:disabled) {
    background-color: #dcfce7; /* green-100 */
}

/* Adjust spinner color for secondary button background */
.pdf-toolbar-right .deep-scan-btn .spinner-small {
    border-color: rgba(0,0,0,0.2);
    border-bottom-color: var(--text-color);
}


/* responsive */
@media (max-width:900px) {
  .pdf-filmstrip { display:none; }
  .pdf-body { height: calc(100% - 62px); }
}

@media (max-width: 768px) {
  .options-dropdown {
      left: 0; /* On mobile, button is on the left of its group */
      right: auto;
      transform: none;
      animation: none; /* Remove jumpy animation */
  }
  .pdf-toolbar {
    padding: 0.25rem;
    gap: 0.25rem;
    flex-wrap: nowrap; /* Force single line */
    justify-content: space-between;
    height: auto;
    align-items: center;
  }
  
  .pdf-toolbar-left,
  .pdf-toolbar-right {
    flex-shrink: 0;
  }

  .pdf-toolbar-center {
    order: 0; 
    flex-basis: auto;
    flex-shrink: 1; /* Allow center group to shrink to fit */
    min-width: 0;
    justify-content: center;
    gap: 0.25rem;
  }

  /* Make button groups invisible on mobile */
  .pdf-toolbar-group {
    background: none;
    border: none;
    box-shadow: none;
    padding: 0;
    margin: 0;
    align-items: center;
  }
  
  /* Hide the dedicated zoom controls on mobile; they are in the options menu */
  .zoom-controls-group {
    display: none;
  }
  
  /* Remove separator lines */
  .pdf-toolbar-group > *:not(:last-child) {
    border-right: none;
  }

  /* Make all buttons inside groups look like bare icon buttons */
  .pdf-toolbar-group .btn-icon,
  .pdf-toolbar .btn-icon {
    background: transparent;
    border: none;
    box-shadow: none;
    color: var(--text-muted-color);
    width: 36px; /* Smaller buttons */
    height: 36px;
  }
  .pdf-toolbar .btn-icon-bare {
    width: 36px;
    height: 36px;
  }

  .pdf-toolbar-group .btn-icon:hover:not(:disabled),
  .pdf-toolbar .btn-icon:hover:not(:disabled) {
    background-color: #e5e7eb;
    border-radius: 50%;
    color: var(--text-color);
  }

  /* Ensure consistent height and remove any residual group styling */
  .pdf-toolbar-group > .btn-icon,
  .pdf-toolbar-group > .page-input-container,
  .pdf-toolbar .btn-icon-bare,
  .pdf-toolbar .btn-icon {
      height: 36px;
  }

  /* Re-style the page navigator to be more compact */
  .page-input-container {
    background-color: #f3f4f6;
    border: 1px solid var(--border-color);
    border-radius: 9999px; /* Pill shape */
    padding: 0 0.4rem;
  }
  
  .page-input {
      width: 3ch; /* Shrink input width */
      font-size: 0.9rem;
  }
  
  .page-total {
      font-size: 0.85rem;
  }

  /* Style deep scan button on mobile to include text */
  .pdf-toolbar-right .deep-scan-btn {
      height: 36px; /* match other mobile buttons */
      padding: 0 0.6rem;
      font-size: 0.85rem;
  }
}